---
title: "Covid91 vaccine study Final2021"
author: Erick Barraza"
date: "Summer 2021"
output: 
    html_document:
    toc: true
---

```{r include=FALSE,echo=FALSE}
require(tidyverse)
require(tigerstats)
require(forcats)
OldData <-read.csv(file="covid91.csv",header=TRUE)
#recode to remove the annoying "X" from the dataframe
FinalData <- OldData %>%  mutate(infected = recode(infected, aids = "covid", none = "OK")) %>% select(-one_of("X"))
FinalData<- FinalData %>%
mutate(across(where(is.character), as.factor))  
#FinalData$treatment <- relevel(FinalData$treatment,ref="placebo")
FinalData$infected <- relevel(FinalData$infected,ref="OK")
guy = filter(FinalData, sex == "guy")
gals = filter(FinalData, sex == "gal")
gay = filter(FinalData, LGBTQ == "gay")
DrugUser = filter(FinalData, DrugUser == "yes")
```
```{r }
# this is the slick way
FinalData= select(FinalData, ! is.numeric)
FinalData=purrr::map(FinalData, as.factor)
FinalData = data.frame(FinalData)
```
```{r}
#FinalData$treatment <- relevel(FinalData$treatment,ref="placebo")
FinalData$infected <- relevel(FinalData$infected,ref="OK")
```

# Introduction

A new  preventative vaccine (covid91) is under test in clinical trials. Given the nature of this vaccine it is suspected that the drug may exhibit different effectiveness across the variety of subpopulations tracked. Consider population subgroups by gender( guys and gals), drug use, and sexual orientation. Write a complete report that separately considers this drug for each subgroup and your recommendations as to whether people in the subgroup should take the vaccine. Structure your report in four sections each devoted to one of the four subgroups, use null and alternative hypothesis statements and correct statistical verbage when referencing p-values in conclusions.

# Overall Approach
  
To understand this, we must know if there is a placebo in place, if not then we can take that out first. If there is a placebo than we can compare it to those who had actually taken the drug. A barchart would be a great visual. Looking at the data in their environment tab, there is a placebo for the old data which means we must compare the old data with the placebo. The FinalData will be compared to those who had covid and took the drug compared to those who had covid and didn't take the drug.Then we can use the 95% interval in order to make sure out stats and numbers are correct.

## Gals
  

```{r}
GalsData <-filter(FinalData, sex == "gal")
GalsData$sex <- as.factor(GalsData$sex)
GalsData$treatment <- as.factor(GalsData$treatment)

#GalsData$infected <- relevel(GalsData$infected,ref ="OK")
GalsData$treatment <-relevel(GalsData$treatment,ref="placebo")
```

```{r}
dd2 <- GalsData %>% group_by(infected,treatment) %>% summarize(count=n()) %>% mutate(prcnt=count/sum(count))


# the group_by followed by summarize(count=n())

basicC <- ggplot(dd2,aes(x=treatment,y=count,fill=infected))
basicC + geom_bar(stat="identity",position="dodge")

#Now for percentage plot

basicCC <- ggplot(dd2,aes(x=infected,y=prcnt*100,fill=treatment)) 
basicCC + geom_bar(stat="identity", position = "dodge")
```

### Numerical Results 
  
```{r}
table1 <- xtabs(~treatment + infected, data=GalsData)
rowPerc(table1)
colPerc(table1)
```
  
### Inferntial

```{r}
chisq.test(table1)
chisqtestGC(table1)
galfish <- fisher.test(table1)
galfish
```


```{r}
Effect<- galfish$p.value/(galfish$p.value+1)
Effectivenessgal <- galfish$estimate/(galfish$estimate +1)
print(Effectivenessgal*100)
```

```{r}
low=(galfish$conf.int[1]/(galfish$conf.int[1]+1))
hi=galfish$conf.int[2]/(galfish$conf.int[2] +1)
options(digits=2)
```



## Guys

```{r}
GuysData <-filter(FinalData, sex == "guy")
GuysData$sex <- as.factor(GuysData$sex)
GuysData$treatment <- as.factor(GuysData$treatment)

#GuysData$infected <- relevel(GuysData$infected,ref ="OK")
GuysData$treatment <-relevel(GuysData$treatment,ref="placebo")
```

```{r}
dd2 <- GuysData %>% group_by(infected,treatment) %>% summarize(count=n()) %>% mutate(prcnt=count/sum(count))


# the group_by followed by summarize(count=n())

basicC <- ggplot(dd2,aes(x=treatment,y=count,fill=infected))
basicC + geom_bar(stat="identity",position="dodge")

#Now for percentage plot

basicCC <- ggplot(dd2,aes(x=infected,y=prcnt*100,fill=treatment)) 
basicCC + geom_bar(stat="identity", position = "dodge")
```

### Numerical Results
  
```{r}
table1 <- xtabs(~treatment + infected, data=GuysData)
rowPerc(table1)
colPerc(table1)
```

### Inferntial
 
```{r}
chisq.test(table1)
chisqtestGC(table1)
guyfish <- fisher.test(table1)
guyfish
```  
 
```{r}
Effect<-guyfish$p.value/(guyfish$p.value+1)
Effectivenessguy <- guyfish$estimate/(guyfish$estimate +1)
print(Effectivenessguy*100)
```

```{r}
low=(guyfish$conf.int[1]/(guyfish$conf.int[1]+1))
hi=guyfish$conf.int[2]/(guyfish$conf.int[2] +1)
options(digits=2)
```  

## LGBTQ

```{r}
GayData <-filter(FinalData, LGBTQ == "gay")
GayData$sex <- as.factor(GayData$sex)
GayData$treatment <- as.factor(GayData$treatment)

#GayData$infected <- relevel(GayData$infected,ref ="OK")
GayData$treatment <-relevel(GayData$treatment,ref="placebo")
```

```{r}
dd2 <- GayData %>% group_by(infected,treatment) %>% summarize(count=n()) %>% mutate(prcnt=count/sum(count))


# the group_by followed by summarize(count=n())

basicC <- ggplot(dd2,aes(x=treatment,y=count,fill=infected))
basicC + geom_bar(stat="identity",position="dodge")

#Now for percentage plot

basicCC <- ggplot(dd2,aes(x=infected,y=prcnt*100,fill=treatment)) 
basicCC + geom_bar(stat="identity", position = "dodge")
```

### Numerical  
  

```{r}
table1 <- xtabs(~treatment + infected, data=GayData)
rowPerc(table1)
colPerc(table1)
```


### Inferntial
  
```{r}
chisq.test(table1)
chisqtestGC(table1)
gayfish <- fisher.test(table1)
gayfish
```  

 
```{r}
Effect<-gayfish$p.value/(gayfish$p.value+1)
Effectivenessgay <- gayfish$estimate/(gayfish$estimate +1)
print(Effectivenessgay*100)
```

```{r}
low=(guyfish$conf.int[1]/(guyfish$conf.int[1]+1))
hi=guyfish$conf.int[2]/(guyfish$conf.int[2] +1)
options(digits=2)
```  

## DrugUsers


```{r}
DrugUserData <-filter(FinalData, DrugUser == "yes")
DrugUserData$sex <- as.factor(DrugUserData$sex)
DrugUserData$treatment <- as.factor(DrugUserData$treatment)

#DrugUserData$infected <- relevelDrugUserData$infected,ref ="OK")
DrugUserData$treatment <-relevel(DrugUserData$treatment,ref="placebo")
```

```{r}
dd2 <- DrugUserData %>% group_by(infected,treatment) %>% summarize(count=n()) %>% mutate(prcnt=count/sum(count))


# the group_by followed by summarize(count=n())

basicC <- ggplot(dd2,aes(x=treatment,y=count,fill=infected))
basicC + geom_bar(stat="identity",position="dodge")

#Now for percentage plot

basicCC <- ggplot(dd2,aes(x=infected,y=prcnt*100,fill=treatment)) 
basicCC + geom_bar(stat="identity", position = "dodge")
```

### Numerical Results
  
```{r}
table1 <- xtabs(~treatment + infected, data=DrugUserData)
rowPerc(table1)
colPerc(table1)
```

### Inferntial

```{r}
chisq.test(table1)
chisqtestGC(table1)
drugfish <- fisher.test(table1)
drugfish
```

 
```{r}
Effect<-drugfish$p.value/(drugfish$p.value+1)
Effectivenessyes <- drugfish$estimate/(drugfish$estimate +1)
print(Effectivenessyes*100)
```

```{r}
low=(drugfish$conf.int[1]/(drugfish$conf.int[1]+1))
hi=drugfish$conf.int[2]/(drugfish$conf.int[2] +1)
options(digits=2)
```  
